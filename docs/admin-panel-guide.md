# Інструкція з роботи в адмін-панелі магазину

## 1. Загальні принципи
- **Призначення панелі.** Панель "Панель магазину" згрупована за напрямами каталогу, продажів, бухгалтерії, запасів, маркетингу, контенту, клієнтів та налаштувань, що допомагає швидко знайти потрібний модуль.【F:resources/lang/uk/shop.php†L11-L21】
- **Локалізація.** Персонал може перемикати мову інтерфейсу у вбудованому перемикачі; вибрана локаль зберігається у cookie `lang`, тож після перезавантаження користувач працює у потрібній мові.【F:Readme.md†L15-L18】【F:resources/lang/uk/shop.php†L22-L25】
- **Розмежування доступів.** Усі розділи перевіряють дозволи перед завантаженням, тому для кожного співробітника важливо обирати правильну роль. Наприклад, ресурси товарів фільтрують дані за дозволеними категоріями або поточним продавцем користувача.【F:database/seeders/FullDemoSeeder.php†L97-L156】【F:app/Filament/Mine/Resources/Products/ProductResource.php†L46-L74】
- **Єдині фільтри часу.** Віджети дашборду підтримують однакові періоди (`сьогодні`, 7/30/90 днів), що дозволяє робити зрізи у порівнянні між модулями.【F:resources/lang/uk/shop.php†L26-L65】【F:app/Filament/Mine/Widgets/SalesOverviewWidget.php†L15-L44】

## 2. Ролі та сфери відповідальності
| Роль | Ключові дозволи | Основні розділи |
| --- | --- | --- |
| Administrator | Усі дозволи системи | Усі меню, включно з налаштуваннями без обмежень.【F:database/seeders/FullDemoSeeder.php†L97-L108】 |
| Accountant | Документи продажів та SAF-T | Рахунки, накладні, акти, журнали SAF-T.【F:database/seeders/FullDemoSeeder.php†L99-L107】 |
| Catalog manager | Каталог, склади, відгуки | Товари, категорії, запаси, продавці, модерація відгуків.【F:database/seeders/FullDemoSeeder.php†L109-L120】 |
| Order manager | Замовлення та фінансові документи | Замовлення, пов’язані документи, SAF-T.【F:database/seeders/FullDemoSeeder.php†L121-L132】 |
| Marketing manager | Купони, розсилки, сегменти, A/B | Email- та push-кампанії, сегменти, тести, купони.【F:database/seeders/FullDemoSeeder.php†L133-L146】 |
| Support | Перегляд/обробка замовлень, клієнти | Замовлення та профілі користувачів.【F:database/seeders/FullDemoSeeder.php†L147-L151】 |

> **Порада:** для точнішого контролю можна комбінувати ролі з прямими дозволами у картці користувача (вкладка "Права" у формі користувача).【F:app/Filament/Mine/Resources/Users/Schemas/UserForm.php†L19-L42】

## 3. Дашборд
- **Показники продажів.** Віджет відображає дохід, кількість замовлень та середній чек у базовій валюті; для аналізу доступні часові фільтри.【F:resources/lang/uk/shop.php†L34-L39】【F:app/Filament/Mine/Widgets/SalesOverviewWidget.php†L18-L44】
- **Конверсія оформлення.** Показує відсоток, кількість замовлень і кошиків за обраний період; варто стежити, щоб конверсія не падала нижче контрольних значень.【F:resources/lang/uk/shop.php†L40-L46】【F:app/Filament/Mine/Widgets/ConversionRateWidget.php†L18-L47】
- **Маркетингові метрики.** Віджет надає кількість відкриттів email, кліків у push та загальні конверсії, із підказкою щодо середньої конверсії за каналом; доступний персоналу з маркетинговими дозволами.【F:app/Filament/Mine/Widgets/MarketingPerformanceWidget.php†L18-L68】 
- **Джерела трафіку.** Діаграма розподіляє дохід за каналами, підтримує ті самі періодичні фільтри, що й інші віджети.【F:resources/lang/uk/shop.php†L47-L49】【F:app/Filament/Mine/Widgets/TrafficSourcesChart.php†L17-L40】
- **Топ-товари.** Таблиця дозволяє змінювати період і сортувати за виручкою чи кількістю; для перевірки KPI можна підключати додаткові фільтри і вивантажувати дані на основі того ж запиту.【F:resources/lang/uk/shop.php†L51-L58】【F:app/Filament/Mine/Widgets/TopProductsTable.php†L28-L71】
- **Стан складу.** Дає кількість SKU, доступних одиниць та позицій із низьким залишком (значення у підказці). Плануйте поповнення, якщо показник низького залишку росте.【F:resources/lang/uk/shop.php†L60-L65】【F:app/Filament/Mine/Widgets/InventoryStatusWidget.php†L15-L33】

## 4. Каталог
### 4.1 Товари
- **Список.** Колонки включають прев’ю, назву, SKU, категорію, продавця (при потребі), залишки та ціни; фільтри за категорією і статусом "активний" спрощують сегментацію. Видимість продавця автоматично ховається для акаунтів продавців.【F:app/Filament/Mine/Resources/Products/Tables/ProductsTable.php†L24-L189】
- **Форма.** Підтримує багатомовні назви/описи, вибір категорії з урахуванням обмежень ролі, вибір продавця (з блокуванням для користувачів-продавців), динамічні атрибути з перекладами, ціни та перемикач активності.【F:app/Filament/Mine/Resources/Products/Schemas/ProductForm.php†L33-L195】
- **Права доступу.** Список і форма повертають лише дозволені категорії й товари поточного продавця, що запобігає випадковому редагуванню чужих позицій.【F:app/Filament/Mine/Resources/Products/ProductResource.php†L46-L74】
- **Імпорт/експорт.** Сторінка імпорту приймає CSV/XLSX до 10 МБ, ставить задачу в чергу і зберігає історію останніх запусків. У журналі видно статус, прогрес та кількість створених/оновлених/помилкових рядків; аналогічний блок показує останні експорти, які теж ставляться в чергу.【F:resources/lang/uk/shop.php†L71-L154】【F:app/Filament/Mine/Resources/Products/Pages/ImportProducts.php†L36-L113】【F:resources/views/filament/mine/resources/products/pages/import-products.blade.php†L1-L87】

### 4.2 Категорії
- Структура підтримує багатомовні назви та ієрархію "батько-донька" з автоматичною перевіркою, що категорія не може бути власним батьком.【F:app/Filament/Mine/Resources/Categories/Schemas/CategoryForm.php†L17-L49】

### 4.3 Продавці
- **Фільтрація.** Менеджер-продавець бачить лише власну картку; адміністратори можуть оглядати всі записи.【F:app/Filament/Mine/Resources/Vendors/VendorResource.php†L39-L90】
- **Форма.** Прив’язка до користувача-власника, перекладні назва й опис, контактні поля. Поле власника блокується, якщо поточний користувач уже прив’язаний до продавця.【F:app/Filament/Mine/Resources/Vendors/Schemas/VendorForm.php†L26-L91】

### 4.4 Запаси
- **Форма.** Вимагає унікальності пари товар-склад, блокує зміну цих полів під час редагування та дозволяє редагувати доступні/зарезервовані кількості з перевіркою на невід’ємні значення.【F:app/Filament/Mine/Resources/Inventory/InventoryResource.php†L36-L100】
- **Список.** Містить колонки по товарах, складах, кількостях, а також фільтр за складом для швидкого огляду залишків.【F:app/Filament/Mine/Resources/Inventory/InventoryResource.php†L102-L146】

### 4.5 Відгуки
- **Модерація.** Менеджер бачить товар, покупця, оцінку і статус (очікує/схвалено/відхилено); фільтр за статусом допомагає групувати запити. Можна змінювати текст і статус, але пов’язані товар/користувач і рейтинг доступні лише для читання.【F:app/Filament/Mine/Resources/Reviews/Tables/ReviewsTable.php†L16-L53】【F:app/Filament/Mine/Resources/Reviews/Schemas/ReviewForm.php†L15-L37】

## 5. Продажі та підтримка
### 5.1 Замовлення
- **Список.** Відображає номер, суму, статус зі значком та швидкі дії: редагувати, перейти в чат повідомлень, позначити як оплачене/відправлене (з можливістю додати трек-номер), скасувати або повторно надіслати підтвердження клієнту.【F:app/Filament/Mine/Resources/Orders/Tables/OrdersTable.php†L25-L141】
- **Форма.** Складається з блоків загальних даних, адрес доставки/оплати, нотаток та інформації про відвантаження; статуси тягнуться з enum і підказок у локалізації. Поля номеру й суми тільки для перегляду, оскільки генеруються автоматично.【F:app/Filament/Mine/Resources/Orders/Schemas/OrderForm.php†L27-L127】
- **Спілкування з клієнтом.** В окремій сторінці "Повідомлення" можна переглядати історію звернень і надсилати відповіді; повідомлення позначаються кольором залежно від автора, що зменшує плутанину.【F:app/Filament/Mine/Resources/Orders/Pages/OrderMessages.php†L21-L99】【F:resources/views/filament/mine/resources/orders/pages/messages.blade.php†L1-L41】
- **Обмеження продавців.** Якщо користувач прив’язаний до продавця, замовлення фільтруються за товарами цього продавця, що унеможливлює перегляд сторонніх замовлень.【F:app/Filament/Mine/Resources/Orders/OrderResource.php†L37-L44】

### 5.2 Фінансові документи та SAF-T
- **Рахунки.** Форма дозволяє прив’язати рахунок до замовлення, заповнити реквізити, метадані та завантажити PDF/CSV/XML зі спеціальної кнопки в таблиці. Фільтр за статусом допомагає контролювати неоплачені документи.【F:app/Filament/Mine/Resources/Invoices/InvoiceResource.php†L30-L93】
- **SAF-T експорт.** Сторінка запуску приймає формат файлу, фільтри за замовленням і датами, після чого показує останній запуск із посиланням на журнал; у журналі можна завантажити готовий файл або відфільтрувати записи за статусом.【F:app/Filament/Mine/Resources/SoftExportLogs/Pages/ExportSaft.php†L31-L66】【F:resources/views/filament/mine/resources/saft-export-logs/pages/export.blade.php†L1-L44】【F:app/Filament/Mine/Resources/SoftExportLogs/SoftExportLogResource.php†L35-L129】

## 6. Маркетинг
### 6.1 Купони
- **Форма.** Підтримує код, локалізовані назву й опис, тип (фіксована сума або відсоток), порогові значення, обмеження та період дії; статус "активний" вмикається перемикачем. Значення в грошах автоматично форматуються з префіксом валюти, а відсотки — знаком `%`.【F:app/Filament/Mine/Resources/Coupons/Schemas/CouponForm.php†L20-L80】
- **Список.** Показує фактичне значення (у форматі валюти або відсотку), мінімальну суму кошика, використання/ліміти та дати дії. Є фільтр за активністю, що допомагає відокремити архівні купони.【F:app/Filament/Mine/Resources/Coupons/Tables/CouponsTable.php†L20-L57】

### 6.2 Email-кампанії
- **Форма.** Складається з секції деталей (назва, шаблон, статус, час запуску, сегменти, додаткові налаштування), метрик (тільки для читання) та графіка розсилок з cron-виразом, часовим поясом і вікном активності.【F:app/Filament/Mine/Resources/EmailCampaigns/Schemas/EmailCampaignForm.php†L17-L66】
- **Графік запусків.** Після збереження `persistSchedule` або видаляє існуючий графік, або оновлює cron-вираз і планування та гарантує наявність наступного запуску через сервіс планування.【F:app/Filament/Mine/Resources/EmailCampaigns/EmailCampaignResource.php†L96-L118】
- **Список.** Дозволяє стежити за статусами, кількістю сегментів, метриками відкриттів/кліків/конверсій та датою останньої відправки; можна відфільтрувати кампанії за статусом.【F:app/Filament/Mine/Resources/EmailCampaigns/Tables/EmailCampaignsTable.php†L17-L53】

### 6.3 Сегменти клієнтів
- **Форма.** Містить назву, опис, перемикач активності, зв’язок із кампаніями та набір умов (key-value), що дозволяє маркетингу фіксувати правила аудиторії.【F:app/Filament/Mine/Resources/Segments/Schemas/SegmentForm.php†L13-L33】
- **Список.** Показує активність, кількість пов’язаних кампаній і час створення/оновлення; є фільтр за активністю.【F:app/Filament/Mine/Resources/Segments/Tables/SegmentsTable.php†L13-L36】

## 7. Клієнти та персонал
- **Користувачі.** Список відображає ім’я, email, баланс лояльності та дату створення. Дії "Переглянути"/"Редагувати" доступні лише тим, хто має відповідні права.【F:app/Filament/Mine/Resources/Users/Tables/UsersTable.php†L14-L28】
- **Форма користувача.** Дозволяє змінювати ім’я, email, пароль, ролі, дозволи та прив’язані категорії (для менеджерів каталогу). Пароль обов’язковий лише при створенні; під час редагування можна залишити поле порожнім, щоб не змінювати його.【F:app/Filament/Mine/Resources/Users/Schemas/UserForm.php†L12-L41】
- **Ролі та дозволи.** У модулі "Ролі" можна одразу призначати права й синхронізувати вибрані ролі з користувачами (з вибором режиму "замінити" чи "додати"). Аналогічно працює ресурс "Дозволи", але з призначенням конкретних дозволів користувачам.【F:resources/lang/uk/shop.php†L201-L227】【F:app/Filament/Mine/Resources/Roles/Schemas/RoleForm.php†L13-L34】【F:app/Filament/Mine/Resources/Roles/Tables/RolesTable.php†L21-L103】

## 8. Контрольні списки для щоденної роботи
1. **На початку зміни:**
   - Перевірити дашборд на аномалії продажів/конверсії та рівні запасів.【F:app/Filament/Mine/Widgets/SalesOverviewWidget.php†L18-L44】【F:app/Filament/Mine/Widgets/InventoryStatusWidget.php†L20-L33】
   - Відфільтрувати таблицю замовлень за статусом "нові" і розподілити їх між відповідальними.【F:app/Filament/Mine/Resources/Orders/Tables/OrdersTable.php†L25-L140】
2. **Упродовж дня:**
   - Каталог менеджери перевіряють відгуки зі статусом "очікує" та змінюють на "схвалено" або "відхилено" з коментарем для історії.【F:app/Filament/Mine/Resources/Reviews/Tables/ReviewsTable.php†L16-L53】
   - Маркетинг стежить за відкриттями email-кампаній і, за потреби, коригує розклад або сегменти.【F:app/Filament/Mine/Resources/EmailCampaigns/Tables/EmailCampaignsTable.php†L17-L39】【F:app/Filament/Mine/Resources/EmailCampaigns/EmailCampaignResource.php†L96-L118】
3. **Наприкінці дня:**
   - Акаунтанти запускають SAF-T або перевіряють статус останніх експортів і завантажують файли для бухгалтерії.【F:app/Filament/Mine/Resources/SoftExportLogs/Pages/ExportSaft.php†L31-L66】【F:app/Filament/Mine/Resources/SoftExportLogs/SoftExportLogResource.php†L35-L88】
   - Служба підтримки переглядає повідомлення з клієнтами, щоб закрити відкриті діалоги.【F:app/Filament/Mine/Resources/Orders/Pages/OrderMessages.php†L32-L74】

## 9. Типові помилки та як їх уникнути
- **Файли імпорту без даних.** Якщо завантажено порожній файл, система повідомить про відсутність рядків; перевіряйте шаблон перед завантаженням.【F:resources/lang/uk/shop.php†L85-L113】
- **Подвійні записи запасів.** Спроба створити запас для тієї ж пари товар-склад викличе помилку завдяки унікальним правилам — переконайтеся, що вибираєте правильний склад.【F:app/Filament/Mine/Resources/Inventory/InventoryResource.php†L47-L88】
- **Неправильний cron для розсилок.** Порожній вираз видаляє розклад; завжди перевіряйте cron-рядок, щоб кампанії продовжували працювати.【F:app/Filament/Mine/Resources/EmailCampaigns/EmailCampaignResource.php†L96-L118】
- **Відправка повідомлення клієнту без тексту.** Форма повідомлення вимагає обов’язковий текст, тому використовуйте заготовлені відповіді або шаблони, щоб уникнути пустих відправок.【F:app/Filament/Mine/Resources/Orders/Pages/OrderMessages.php†L43-L74】

## 10. Корисні звички
- Регулярно оновлюйте ролі й дозволи для персоналу, щоб уникнути надмірних прав.【F:app/Filament/Mine/Resources/Roles/Tables/RolesTable.php†L21-L103】
- Використовуйте фільтри таблиць перед масовими операціями (видалення, експорт), щоб не торкнутися зайвих записів.【F:app/Filament/Mine/Resources/Products/Tables/ProductsTable.php†L166-L189】【F:app/Filament/Mine/Resources/Coupons/Tables/CouponsTable.php†L32-L57】
- Після виконання фонових задач (імпорт, експорт) завжди перевіряйте історію на предмет помилок і повторно запускайте тільки після виправлення джерельних даних.【F:resources/views/filament/mine/resources/products/pages/import-products.blade.php†L28-L87】【F:app/Filament/Mine/Resources/SoftExportLogs/SoftExportLogResource.php†L35-L88】

Цей гайд можна використовувати як чекліст onboarding'у та щоденних процедур: він описує логіку форм, призначення полів і критичні сценарії для кожної ролі, щоб мінімізувати помилки під час роботи з адмін-панеллю.
