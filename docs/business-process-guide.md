# Бізнес-інструкція: життєвий цикл замовлення

## 1. Загальний ланцюжок
1. Підготуйте каталог і склади в адмін-панелі (товари, залишки, доставку).
2. Клієнт переглядає вітрину, додає позиції до кошика й переходить у checkout.
3. Під час оформлення збираються контакти, адреси, спосіб доставки, знижки й оплати.
4. Після створення замовлення автоматично резервуються товари, нараховуються/списуються бонуси, клієнт отримує підтвердження.
5. Менеджер підтверджує оплату, готує відвантаження, формує документи й оновлює статуси.
6. Після доставки готується комплект бухгалтерських документів і за потреби виконується SAF-T експорт.

## 2. Підготовка каталогу та запасів
- **Каталог.** Структуруйте категорії, ціни та атрибути на сторінках товарів; фільтри, сортування й відстеження списків товарів доступні відвідувачам одразу після заповнення даних.【F:resources/js/shop/pages/Catalog.tsx†L34-L150】
- **Картка товару.** Перевірте, що фото, описи, характеристики, відгуки й рекомендовані товари заповнені — сторінка показує галерею, сумісні товари та дозволяє додати позицію до кошика з урахуванням залишків.【F:resources/js/shop/pages/Product.tsx†L37-L399】
- **Запаси.** Менеджер складу веде залишки по складах із контролем унікальності пари товар-склад і полями "кількість/зарезервовано/доступно"; зміни одразу впливають на наявність у checkout.【F:app/Filament/Mine/Resources/Inventory/InventoryResource.php†L36-L145】

## 3. Клієнтська подорож
### 3.1. Вибір товарів
- Клієнт користується пошуком, категоріями, кольорами, розмірами й діапазоном цін, після чого додає товар у кошик; система фіксує перегляди та додавання для аналітики.【F:resources/js/shop/pages/Catalog.tsx†L45-L149】
- На сторінці товару покупець бачить галерею, характеристики, рейтинг, відгуки, схожі позиції та може обрати кількість перед додаванням у кошик.【F:resources/js/shop/pages/Product.tsx†L80-L399】

### 3.2. Кошик і перехід до оформлення
- Кошик показує підсумок замовлення й не дозволяє перейти далі, якщо немає жодної позиції; кнопка веде прямо до `/checkout`.【F:resources/js/shop/pages/Cart.tsx†L158-L172】
- Міні-кошик у хедері дозволяє перейти до checkout безпосередньо зі списку товарів.【F:resources/js/shop/components/MiniCart.tsx†L69-L77】

### 3.3. Checkout
- **Крок адрес.** Збираються email, збережені адреси, нова адреса доставки й за потреби реквізити для рахунку; валідація показує помилки інлайн.【F:resources/js/shop/pages/Checkout.tsx†L505-L599】【F:resources/js/shop/pages/Checkout.tsx†L640-L799】
- **Крок доставки.** Покупець обирає метод (кур’єр, пошта, самовивіз) і залишає коментар кур’єру.【F:resources/js/shop/pages/Checkout.tsx†L824-L856】
- **Знижки та програми лояльності.** Купон перевіряється в реальному часі, а накопичені бонуси можна списати перед оплатою; дані синхронізуються з API лояльності.【F:resources/js/shop/pages/Checkout.tsx†L861-L912】【F:tests/Feature/LoyaltyPointsTest.php†L5-L155】
- **Підсумок і оплата.** Після створення замовлення кошик очищується, клієнт переходить на крок оплати, де бачить номер замовлення, підсумок і статуси платежу.【F:resources/js/shop/pages/Checkout.tsx†L430-L505】【F:resources/js/shop/pages/Checkout.tsx†L953-L1056】
- У разі відсутності товару клієнта перенаправляє на сторінку "sold-out" для оновлення кошика.【F:resources/js/shop/pages/Checkout.tsx†L445-L466】

### 3.4. Підтвердження замовлення
- Сторінка підтвердження показує статус оплати, трек-номер, адреси, склад замовлення й дозволяє відкрити чат із менеджером для уточнень.【F:resources/js/shop/pages/OrderConfirmation.tsx†L139-L258】
- Клієнт може відстежувати доставку та повторно перейти до картки товару чи сторінки продавця зі списку позицій.【F:resources/js/shop/pages/OrderConfirmation.tsx†L230-L260】

## 4. Автоматичні процеси після створення замовлення
- Замовлення отримує унікальний номер, статус `new` та email покупця, якщо він зареєстрований; під час зміни статусу перераховується підсумок із урахуванням знижок.【F:app/Models/Order.php†L19-L85】【F:app/Models/Order.php†L215-L273】
- Перехід у статус `paid` резервує складські залишки, `shipped` списує їх назавжди, а скасування повертає товари на склад.【F:app/Models/Order.php†L97-L210】【F:app/Models/Order.php†L274-L359】
- Програма лояльності автоматично нараховує й списує бонуси залежно від оплати замовлення, синхронізуючи баланс користувача.【F:tests/Feature/LoyaltyPointsTest.php†L5-L155】

## 5. Обслуговування замовлення в адмін-панелі
- **Список замовлень.** Менеджер бачить номер, суму, статуси та може редагувати запис, перейти в повідомлення, позначити оплату/відправку, додати трек-номер, скасувати або повторно надіслати підтвердження клієнту.【F:app/Filament/Mine/Resources/Orders/Tables/OrdersTable.php†L23-L141】
- **Комунікація.** На сторінці повідомлень менеджер читає всю історію звернень і відповідає клієнтові; система вимагатиме заповнення тексту та повідомить про успішну відправку.【F:app/Filament/Mine/Resources/Orders/Pages/OrderMessages.php†L32-L99】
- **Контроль запасів.** Перед відвантаженням оновіть складські залишки, щоб уникнути резервування недоступних товарів.【F:app/Models/Order.php†L274-L359】【F:app/Filament/Mine/Resources/Inventory/InventoryResource.php†L102-L145】

## 6. Документи продажу та логістики
- **Рахунки.** Створіть або відредагуйте інвойс, завантажте його у PDF/CSV/XML, відстежуйте статус і дати виставлення/оплати.【F:app/Filament/Mine/Resources/Invoices/InvoiceResource.php†L38-L135】
- **Видаткові накладні.** Формуйте накладні з переліком позицій, датами відвантаження й статусом; доступне масове вивантаження у кількох форматах.【F:app/Filament/Mine/Resources/DeliveryNotes/DeliveryNoteResource.php†L39-L121】
- **Акти виконаних робіт/передачі.** Для B2B-замовлень створюйте акти з датою, сумою та описом і експортуйте у потрібному форматі.【F:app/Filament/Mine/Resources/Acts/ActResource.php†L38-L118】

## 7. Регуляторна звітність
- Для надання даних аудиторам або податковим органам запускайте SAF-T експорт: оберіть формат, замовлення чи період і дочекайтеся сповіщення про готовність файлу.【F:app/Filament/Mine/Resources/SoftExportLogs/Pages/ExportSaft.php†L40-L94】

## 8. Післяпродажне обслуговування
- Стежте за статусами оплати й доставки, за потреби оновлюйте їх вручну через дії "Mark paid"/"Mark shipped"; система синхронізує дані з клієнтською сторінкою підтвердження та відображає трек-номер.【F:app/Filament/Mine/Resources/Orders/Tables/OrdersTable.php†L84-L118】【F:resources/js/shop/pages/OrderConfirmation.tsx†L167-L210】
- Використовуйте чат замовлення для узгодження повернень або допоставок — клієнт бачить відповіді миттєво у своєму кабінеті.【F:resources/js/shop/pages/OrderConfirmation.tsx†L167-L188】【F:app/Filament/Mine/Resources/Orders/Pages/OrderMessages.php†L56-L99】

Ця інструкція охоплює всі ролі: від менеджера каталогу й складу до бухгалтерії та підтримки. Дотримуйтеся послідовності кроків, щоб забезпечити прозорий рух товару, грошей і документів на кожному етапі замовлення.
