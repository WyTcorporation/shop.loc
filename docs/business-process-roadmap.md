# Роудмеп адміністрування замовлення з прикладами

> **Сценарій**: клієнт Олена оформлює замовлення №2024-00087 на кросівки (2 пари) і рюкзак. Оплата — карткою онлайн, доставка — "Нова пошта", самовивіз із відділення. Нижче описано, що робить кожна роль у панелі керування після створення замовлення, які поля заповнює та які документи формує.

## 1. Менеджер замовлень
1. **Отримання замовлення**
   - Відкриває `Продажі → Замовлення`. За замовчуванням таблиця відфільтрована на статус `new`.
   - Перевіряє контактні дані клієнта, позиції та суму у формі замовлення.【F:app/Filament/Mine/Resources/Orders/Schemas/OrderForm.php†L27-L127】
   - Якщо потрібно внести правки (наприклад, змінити коментар клієнта), редагує відповідні поля і натискає **Зберегти**.
2. **Верифікація оплати**
   - У тій самій таблиці застосовує дію **Mark paid**. Система автоматично оновлює статус на `paid`, резервує залишки і фіксує час оплати.【F:app/Models/Order.php†L97-L274】【F:app/Filament/Mine/Resources/Orders/Tables/OrdersTable.php†L84-L118】
   - Якщо платіж не підтверджено, залишає статус `pending` і створює нотатку в полі "Коментар менеджера".
3. **Комунікація з клієнтом**
   - Натискає дію **Messages** у таблиці замовлень і відповідає на питання клієнта прямо в чаті. Повідомлення без тексту не відправляться, тож користується шаблоном відповіді.【F:app/Filament/Mine/Resources/Orders/Pages/OrderMessages.php†L32-L99】
   - Уточнює бажану дату відправлення чи доп. пакування і фіксує відповідь у чаті.
4. **Передача на склад**
   - Після підтвердження оплати ставить статус `processing`. Це сигналізує складу, що замовлення можна збирати.
   - Додає трек-номер після отримання від логістів через дію **Mark shipped** (доступне поле "Tracking number").【F:app/Filament/Mine/Resources/Orders/Tables/OrdersTable.php†L96-L118】

## 2. Менеджер складу / логістики
1. **Підготовка до комплектації**
   - Відкриває `Каталог → Запаси` і шукає товари замовлення за SKU або фільтром складу.
   - Перевіряє, що кількість "доступно" ≥ потрібної. Якщо залишок нульовий, повідомляє менеджера замовлень через чат, щоб запропонувати альтернативу.【F:app/Filament/Mine/Resources/Inventory/InventoryResource.php†L36-L145】
2. **Збір і пакування**
   - Зменшує поле "Зарезервовано" відповідного запису на кількість, яку віддали кур’єру, після чого фіксує фактичне списання: перемикає замовлення в статус `shipped` (або повідомляє менеджеру зробити це).
   - Додає в коментар замовлення номер пломби або комірки складу, якщо це потрібно для внутрішнього контролю.
3. **Відвантаження**
   - Для доставки "Нова пошта" створює експрес-накладну в сторонньому кабінеті й вказує номер у полі Tracking.
   - При самовивозі роздруковує видаткову накладну (див. блок бухгалтерії) та передає її клієнту під час видачі.

## 3. Бухгалтер / фінансовий спеціаліст
1. **Перевірка платежів**
   - У розділі `Продажі → Рахунки` відкриває фільтр за статусом `pending`. Для замовлення №2024-00087 система вже створила рахунок зі статусом `paid` після натискання менеджером дії **Mark paid**.
   - Переглядає реквізити: ПІБ Олени, адресу відправки, суму, ПДВ. За потреби оновлює поле "Дата оплати" та додає внутрішній коментар.【F:app/Filament/Mine/Resources/Invoices/InvoiceResource.php†L30-L93】
2. **Формування документів**
   - Натискає дію **Export** у таблиці рахунків та завантажує PDF для архіву і надіслання клієнту.
   - Створює **видаткову накладну** у модулі `Продажі → Видаткові накладні`: вибирає замовлення зі списку, перевіряє перелік товарів, додає дату відвантаження і номер складу.【F:app/Filament/Mine/Resources/DeliveryNotes/DeliveryNoteResource.php†L39-L121】
   - Для корпоративних клієнтів формує **акт виконаних робіт/передачі** через відповідний ресурс, вказуючи суму та опис (наприклад, "Поставка взуття і аксесуарів"), після чого експортує PDF/XML для електронного документообігу.【F:app/Filament/Mine/Resources/Acts/ActResource.php†L38-L118】
3. **SAF-T / регуляторна звітність**
   - Раз на тиждень запускає експорт у `Звітність → SAF-T`. У формі вибирає період, формат (XML) та натискає **Запустити експорт**. Журнал показує статус `completed`; звідти завантажує файл і передає до бухгалтерської системи.【F:app/Filament/Mine/Resources/SoftExportLogs/Pages/ExportSaft.php†L40-L94】

## 4. Маркетолог
1. **Аналіз замовлення**
   - На дашборді перевіряє віджет "Конверсія оформлення" — чи не впало значення після запуску нової акції.【F:app/Filament/Mine/Widgets/ConversionRateWidget.php†L18-L47】
   - Відкриває `Маркетинг → Купони`, щоб переконатися, що код промоакції (наприклад, `SPRING15`) застосовано саме до цього замовлення (колонка "Використано"). Якщо ліміт наближається до вичерпання, планує оновлення промо.【F:app/Filament/Mine/Resources/Coupons/Tables/CouponsTable.php†L20-L57】
2. **Подальша комунікація**
   - У `Маркетинг → Email-кампанії` додає Олену до сегменту "Лояльні клієнти" з умовою "придбала 2+ одиниць". Для цього відкриває потрібний сегмент та додає умову у вкладці правил.【F:app/Filament/Mine/Resources/Segments/Schemas/SegmentForm.php†L13-L33】
   - Планує follow-up розсилку із пропозицією аксесуарів, створюючи нову кампанію зі статусом `scheduled` і cron-графіком на наступний понеділок.【F:app/Filament/Mine/Resources/EmailCampaigns/Schemas/EmailCampaignForm.php†L17-L66】【F:app/Filament/Mine/Resources/EmailCampaigns/EmailCampaignResource.php†L96-L118】

## 5. Служба підтримки
1. **Підтримка клієнта**
   - У модулі повідомлень відстежує відповіді Олени. Якщо клієнт просить змінити дату доставки, координує це з менеджером замовлень і фіксує результат у чаті.
   - Перевіряє вкладку `Клієнти → Користувачі`, щоб побачити історію покупок і баланс бонусів — можна швидко відповісти, чи нарахуються додаткові бали за це замовлення.【F:app/Filament/Mine/Resources/Users/Tables/UsersTable.php†L14-L28】【F:tests/Feature/LoyaltyPointsTest.php†L5-L155】
2. **Післяпродажне обслуговування**
   - Якщо клієнт повідомляє про брак, створює внутрішній тикет (наприклад, за допомогою поля "Internal notes" у замовленні) і координує з складом повернення.
   - Нагадує клієнту про можливість залишити відгук; за потреби передає маркетологу для включення у email-кампанію.

## 6. Узгодження між ролями
- **Щоденний стендап**: менеджер замовлень повідомляє склад про всі замовлення зі статусом `processing`. Бухгалтер перевіряє, чи всі відповідні рахунки мають статус `paid`.
- **Щотижнева звітність**: маркетолог ділиться результатами промо-кампаній, бухгалтер — списком замовлень, що очікують документи, служба підтримки — відкритими питаннями.
- **Після кожного великого релізу**: розробник разом з менеджером проходить усі кроки сценарію на тестовому замовленні, щоб переконатися, що UI і бізнес-логіка працюють без помилок.

## 7. Чекліст для тестування адмінки
1. Створити тестового клієнта й оформити замовлення через checkout.
2. Переконатися, що в адмінці замовлення з’явилось із статусом `new`.
3. Від імені менеджера виконати дії: **Mark paid**, додати трек-номер, перевести у `shipped`.
4. Зайти під бухгалтером, сформувати рахунок і видаткову накладну, експортувати PDF.
5. Перевірити, що у клієнтському кабінеті відобразились оновлені статуси та трек-номер.
6. На стороні маркетолога додати клієнта до сегменту і запланувати розсилку.
7. Оцінити, чи з’явився запис у журналі SAF-T після запуску експорту.

Такий роудмеп допомагає розробнику пройти весь шлях замовлення в адмінці, зрозуміти, які поля критичні для кожної ролі, та перевірити інтеграції (оплата, склад, документообіг, маркетинг) на реальному сценарії.
