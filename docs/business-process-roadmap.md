# Дорожня карта бізнес-процесу магазину

## 1. Узагальнений ланцюжок
1. **Воронка каталогу.** Клієнт потрапляє на сайт, переглядає категорії та товари через API з пагінацією, пошуком, сортуванням і фасетами, після чого формує кошик (з купонами) у сесії `cart_id`.【F:Readme.md†L142-L184】【F:resources/js/shop/pages/Checkout.tsx†L369-L387】
2. **Оформлення замовлення.** На кроці checkout клієнт залишає email, доставку, адреси (окремо для платника) й коментар, після чого створюється замовлення та очищується кошик.【F:resources/js/shop/pages/Checkout.tsx†L390-L439】
3. **Оплата.** Фронт завантажує Stripe Payment Intent, показує форму оплати та відправляє підтвердження; бекенд синхронізує статуси `paid|processing|cancelled` і фіксує час оплати.【F:resources/js/shop/components/PayOrder.tsx†L24-L115】【F:app/Http/Controllers/Api/PaymentController.php†L64-L107】
4. **Підтвердження клієнта.** Після оплати сторінка підтвердження повторно отримує замовлення, реєструє покупку в аналітиці, показує підсумки, трек-номер і статус відвантаження.【F:resources/js/shop/pages/OrderConfirmation.tsx†L70-L150】
5. **Обробка менеджером.** В адмінці замовлення містить загальні дані, адреси, замітку, параметри відвантаження та підсумок; менеджер може помітити оплаченим, відправленим або скасувати.【F:app/Filament/Mine/Resources/Orders/Schemas/OrderForm.php†L27-L127】【F:app/Filament/Mine/Resources/Orders/Pages/EditOrder.php†L55-L106】
6. **Логістика та запаси.** Перехід статусів оновлює резерв/списання запасів, створює чи скидає відвантаження й керує статусом доставок (`pending → delivered`).【F:app/Models/Order.php†L97-L139】【F:app/Enums/ShipmentStatus.php†L5-L33】
7. **Документообіг.** Для кожного замовлення можна виписати рахунок, видаткову/ТТН і акт, завантаживши PDF/CSV/XML; окремо доступний експорт SAF-T за діапазоном дат чи номером замовлення.【F:app/Filament/Mine/Resources/Invoices/InvoiceResource.php†L40-L137】【F:app/Filament/Mine/Resources/DeliveryNotes/DeliveryNoteResource.php†L40-L121】【F:app/Filament/Mine/Resources/Acts/ActResource.php†L40-L119】【F:app/Filament/Mine/Resources/SoftExportLogs/Pages/ExportSaft.php†L40-L95】
8. **Комунікації та контроль.** Система логіює кожну зміну статусу, надсилає email-нотифікації й дозволяє вести діалоги з клієнтом у картці замовлення.【F:app/Observers/OrderObserver.php†L70-L110】【F:app/Filament/Mine/Resources/Orders/Pages/OrderMessages.php†L32-L99】

## 2. Клієнтський шлях крок за кроком
### 2.1 Каталог, пошук і кошик
- Категорії, товари та фасети приходять із REST API, що підтримує фільтри, сортування й пагінацію для формування вітрини та SEO-метаданих.【F:Readme.md†L142-L172】
- Кошик ведеться на бекенді через cookie `cart_id`; користувач може застосувати або зняти купон ще до оформлення замовлення.【F:Readme.md†L179-L184】【F:resources/js/shop/pages/Checkout.tsx†L369-L387】

### 2.2 Оформлення замовлення
- На етапі адрес клієнт вводить контактні дані та, за потреби, платіжні реквізити (компанія, ІПН), після чого переходить до вибору доставки й коментаря.【F:resources/js/shop/pages/Checkout.tsx†L390-L429】
- Після успішного створення замовлення фронт очищує кошик, переходить до оплати й зберігає номер замовлення для подальшого відстеження.【F:resources/js/shop/pages/Checkout.tsx†L430-L495】

### 2.3 Оплата й підтвердження
- Компонент `PayOrder` завантажує клієнтський ключ Stripe, рендерить `PaymentElement` та викликає `confirmPayment`, підтримуючи 3DS/редіректи.【F:resources/js/shop/components/PayOrder.tsx†L24-L115】
- Контролер API опитує Stripe щодо фінального статусу, фіксує `payment_status`, зберігає `payment_intent_id` і за потреби виставляє дату оплати та переходить у `paid`.【F:app/Http/Controllers/Api/PaymentController.php†L64-L107】
- Сторінка підтвердження повторно оновлює статус (враховуючи редірект Stripe), підтягує замовлення та відображає суму, знижки, лояльність, а також дані доставки й трек-номер.【F:resources/js/shop/pages/OrderConfirmation.tsx†L70-L150】

## 3. Процес у адмін-панелі
### 3.1 Первинна перевірка замовлення
- Форма замовлення показує email покупця, статус, номер, загальну суму й обидві адреси, дозволяючи менеджеру доповнити нотатку та дані по доставці (служба, трек-номер, статус).【F:app/Filament/Mine/Resources/Orders/Schemas/OrderForm.php†L27-L117】
- Вкладка "Підсумок" містить окремий перегляд позицій і сум, що допомагає звірити замовлення перед наступними діями.【F:app/Filament/Mine/Resources/Orders/Schemas/OrderForm.php†L119-L127】

### 3.2 Керування статусами
- Доступні кнопки "Mark paid", "Mark shipped" та "Cancel" з підтвердженням: вони з'являються тільки на релевантних стадіях і після виконання оновлюють запис та суму.【F:app/Filament/Mine/Resources/Orders/Pages/EditOrder.php†L55-L106】
- При переході статусів модель замовлення резервує або списує складські залишки, синхронізує пов'язану відправку й оновлює часові мітки для бухгалтерії.【F:app/Models/Order.php†L113-L139】

### 3.3 Комунікація з клієнтом
- Сторінка повідомлень дозволяє менеджеру бачити історію діалогів, відправляти відповіді та отримувати підтвердження успішної відправки повідомлення.【F:app/Filament/Mine/Resources/Orders/Pages/OrderMessages.php†L32-L74】
- Кожна зміна статусу логіюється зі збереженням автора, нотатки та запуском email-нотифікацій, що фіксує офіційний журнал для аудиту.【F:app/Observers/OrderObserver.php†L90-L110】

## 4. Логістика й доставка
- У формі замовлення можна записати метод доставки, трек-номер і статус відправлення; ці поля синхронізуються з пов'язаною моделлю `Shipment`.【F:app/Filament/Mine/Resources/Orders/Schemas/OrderForm.php†L90-L117】
- Статуси доставки мають чіткі мітки й кольори (`pending`, `processing`, `shipped`, `delivered`, `cancelled`), що дозволяє контролювати етапи у звітах та таблицях.【F:app/Enums/ShipmentStatus.php†L5-L33】
- Перехід у `shipped` автоматично оновлює запис відправлення (статус, час відправки), а відміна повертає відвантаження до "cancelled" і прибирає дати доставлення.【F:app/Models/Order.php†L122-L139】

## 5. Фінансові документи й звітність
- **Рахунки.** Менеджер виставляє номер, валюту, суми, статус і метадані; у таблиці доступні експортні дії (PDF/CSV/XML) та фільтр за статусом.【F:app/Filament/Mine/Resources/Invoices/InvoiceResource.php†L40-L137】
- **Видаткові/ТТН.** Delivery Note містить номер, статус, дати формування й відправки, перелік позицій і коментарі, а також ті самі експортні опції.【F:app/Filament/Mine/Resources/DeliveryNotes/DeliveryNoteResource.php†L40-L121】
- **Акти.** Для актів вказується замовлення, номер, дати, статус і опис; бухгалтер може одразу завантажити документ у потрібному форматі.【F:app/Filament/Mine/Resources/Acts/ActResource.php†L40-L119】
- **SAF-T.** Сторінка експорту дозволяє вибрати формат, замовлення та період; після генерації користувач отримує повідомлення й може завантажити останній лог.【F:app/Filament/Mine/Resources/SoftExportLogs/Pages/ExportSaft.php†L40-L95】

## 6. Контроль та рольова модель
- Ролі адміністраторів, менеджерів замовлень, бухгалтерів і маркетингу визначають доступ до відповідних модулів (замовлення, документи, звіти), тож при плануванні процесу варто призначати права під етапи дорожньої карти.【F:database/seeders/FullDemoSeeder.php†L516-L551】
- Логи статусів і документообіг дають можливість реконструювати весь ланцюг від замовлення до фінансового закриття для аудиту чи обробки претензій.【F:app/Observers/OrderObserver.php†L90-L110】【F:app/Filament/Mine/Resources/Acts/ActResource.php†L104-L117】

Ця дорожня карта показує послідовність дій від першого контакту клієнта до підготовки фінансової звітності, що допомагає узгодити роботу e-commerce, логістики та бухгалтерії в одній системі.
